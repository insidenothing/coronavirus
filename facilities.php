<?PHP
// pull assisted living numbers and store just like side zip_codes 

// $array[name] = zip
$Facility_Name['Anchorage_Healthcare_Center'] = '21801';
$Facility_Name['Arbor_Terrace_Fulton']  = '20759';
$Facility_Name['Arden_Courts_of_Pikesville'] = '21208';
$Facility_Name['Aspenwood Senior Living Community'] = '20906';
$Facility_Name['Atrium Village'] = '21117';
$Facility_Name['Autumn Lake Healthcare at Bridgepark'] = '21207';
$Facility_Name['Autumn Lake Healthcare at Cherry Lane'] = '20708';
$Facility_Name['Autumn Lake Healthcare at Oakview'] = '20910';
$Facility_Name['Autumn Lake Healthcare at Riverview'] = '21221';
$Facility_Name['Ballenger Creek - Genesis Healthcare'] = '21703';
$Facility_Name['Berlin Nursing and Rehabilitation Center'] = '21811';
$Facility_Name['Bethesda Health and Rehab'] = '20814';
$Facility_Name['Birch Manor Healthcare Center'] = '21784';
$Facility_Name['Blue Point Healthcare Center'] = '21215';
$Facility_Name['Brighton Gardens at Friendship Heights'] = '20815';
$Facility_Name['Brighton Gardens of Columbia'] = '21045';
$Facility_Name['Brighton Gardens of Tuckerman Lane'] = '20852';
$Facility_Name['Brightview Fallsgrove-Rockville Senior Assisted Living and Memory Care'] = '20850';
$Facility_Name['Brinton Woods Health & Rehabilitation Center at Winfield'] = '21784';
$Facility_Name['Brookdale of Towson'] = '21212';
$Facility_Name['Brookdale Olney'] = '20832';
$Facility_Name['Brooke Grove Retirement Community'] = '20860';
$Facility_Name['Cadia Healthcare - Hagerstown'] = '21742';
$Facility_Name['Cadia Healthcare Wheaton'] = '20902';
$Facility_Name['Cadia Hyattsville'] = '20782';
$Facility_Name['Charlestown Senior Living Community'] = '21228';
$Facility_Name['Charlotte Hall Veterans Home'] = '20622';
$Facility_Name['Chesapeake Woods Center'] = '21613';
$Facility_Name['Citizens Care and Rehabilitation Center - Frederick'] = '21702';
$Facility_Name['Collingswood Rehabilitation and Healthcare Center'] = '20850';
$Facility_Name['Copper Ridge'] = '21784';
$Facility_Name['Corsica Hills Center'] = '21617';
$Facility_Name['Crofton Care and Rehabilitation'] = '21114';
$Facility_Name['Cumberland Healthcare Center'] = '21502';
$Facility_Name['Doctors Community Rehabilitation and Patient Care Center'] = '20706';
$Facility_Name['Edenwald'] = '21286';
$Facility_Name['Fayette Health and Rehabilitation Center'] = '21223';
$Facility_Name['Fox Chase Rehabilitation & Nursing'] = '20910';
$Facility_Name['Frederick Health and Rehabilitation Center'] = '21701';
$Facility_Name['Frederick Villa Nursing and Rehabilitation Center'] = '21228';
$Facility_Name['Friends House Retirement Community'] = '20860';
$Facility_Name['Future Care Irvington'] = '21229';
$Facility_Name['FutureCare Canton Harbor'] = '21224';
$Facility_Name['FutureCare Courtland'] = '21208';
$Facility_Name['FutureCare Homewood'] = '21218';
$Facility_Name['FutureCare Sandtown'] = '21217';
$Facility_Name['Genesis Catonsville Commons'] = '21228';
$Facility_Name['Genesis Cromwell Center'] = '21234';
$Facility_Name['Genesis Hammonds Lane'] = '21225';
$Facility_Name['Genesis Long Green Center'] = '21212';
$Facility_Name['Genesis Severna Park'] = '21146';
$Facility_Name['Genesis Waugh Chapel'] = '21054';
$Facility_Name['Ginger Cove'] = '21401';
$Facility_Name['Glen Burnie Health and Rehabilitation Center'] = '21060';
$Facility_Name['Glen Meadows Retirement Community'] = '21057';
$Facility_Name['Greater Baltimore Medical Center Sub Acute Unit'] = '21204';
$Facility_Name['HeartFields Assisted Living at Frederick'] = '21701';
$Facility_Name['HeartLands Senior Living Village at Ellicott City'] = '21043';
$Facility_Name['Hebrew Home of Greater Washington'] = '20852';
$Facility_Name['Henson Creek Assisted Living'] = '20748';
$Facility_Name['Heritage Center Genesis Eldercare'] = '21222';
$Facility_Name['Holly Hills Manor'] = '21286';
$Facility_Name['Hyattsville Health and Rehab'] = '20783';
$Facility_Name['Ingleside at King Farm'] = '20850';
$Facility_Name['King David Nursing and Rehabilitation Center'] = '21208';
$Facility_Name['Largo Nursing & Rehabilitation Center'] = '20774';
$Facility_Name['Layhill Center'] = '20906';
$Facility_Name['Levindale Hebrew Geriatric Center and Hospital'] = '21215';
$Facility_Name['Little Sisters of the Poor'] = '21228';
$Facility_Name['Longview Nursing Home Inc.'] = '21102';
$Facility_Name['Lorien Columbia'] = '21044';
$Facility_Name['Lorien Mount Airy'] = '21771';
$Facility_Name['Lorien Taneytown'] = '21787';
$Facility_Name['Manor Care Roland Park'] = '21209';
$Facility_Name['Manor Care Wheaton'] = '20902';
$Facility_Name['ManorCare Health Services - Ruxton'] = '21204';
$Facility_Name['ManorCare Health Services- Rossville'] = '21237';
$Facility_Name['ManorCare Health Services- Towson'] = '21286';
$Facility_Name['Maria Health Care Center'] = '21212';
$Facility_Name['Meadow Park Rehabilitation and Healthcare'] = '21228';
$Facility_Name['Montgomery Village Health Care Center'] = '20886';
$Facility_Name['Morningside House of Ellicott City'] = '21042';
$Facility_Name['North Oak'] = '21208';
$Facility_Name['Northwest Health and Rehab Center'] = '21215';
$Facility_Name['Nursing and Rehab Center at Stadium Place'] = '21218';
$Facility_Name['Oak Crest'] = '21234';
$Facility_Name['Orchard Hill Health and Rehab'] = '21204';
$Facility_Name['Patapsco Valley Center'] = '21133';
$Facility_Name['Peak Health Caton Manor'] = '21229';
$Facility_Name['Peake Healthcare at Hartley Hall (Autumn Lake Healthcare at Hartley Hall)'] = '21851';
$Facility_Name['Peake Healthcare at the Pines'] = '21601';
$Facility_Name['Pleasant View Nursing Home'] = '21771';
$Facility_Name['Post Acute Care Center'] = '21206';
$Facility_Name['Potomac Valley Rehabilitation and Healthcare Center'] = '20850';
$Facility_Name['PowerBack Rehabilitation, Brightwood Campus'] = '21093';
$Facility_Name['Regency Care of Silver Spring'] = '20910';
$Facility_Name['SagePoint Nursing and Rehabilitation'] = '20646';
$Facility_Name['Salisbury Rehabilitation and Nursing Center'] = '21804';
$Facility_Name['Seabury at Springvale Terrace'] = '20910';
$Facility_Name['Shady Grove Center for Nursing & Rehabilitation'] = '20850';
$Facility_Name['Shangri-La Assisted Living'] = '21043';
$Facility_Name['Sligo Creek Center - Peak Healthcare'] = '20912';
$Facility_Name['Spa Creek Center'] = '21403';
$Facility_Name['St. Marys Nursing Center'] = '20650';
$Facility_Name['Stella Maris'] = '21093';
$Facility_Name['Sterling Care South Mountain'] = '21713';
$Facility_Name['Summit Park Health & Rehabilitation Center'] = '21228';
$Facility_Name['Sunrise of Columbia'] = '21044';
$Facility_Name['Sunrise Senior Living Bethesda'] = '20814';
$Facility_Name['The Charleston Senior Community'] = '20603';
$Facility_Name['The Neighborhoods at St. Elizabeth Rehabilitation & Nursing Center'] = '21227';
$Facility_Name['The Peartree House Assisted Living'] = '21122';
$Facility_Name['The Resort at Chester Manor'] = '21620';
$Facility_Name['Tribute at Black Hill'] = '20874';
$Facility_Name['Tudor Heights Assisted Living'] = '21208';
$Facility_Name['Village at Augsburg -- Nursing Home'] = '21207';
$Facility_Name['Village at Rockville'] = '20850';
$Facility_Name['Westgate Hills Rehabilitation & Healthcare Center'] = '21229';
$Facility_Name['Westminster Healthcare Center'] = '21157';

function cleanup($str){
   $str = str_replace("'",'',$str);
   $str = str_replace(".",'',$str);
   $str = str_replace("&",'',$str);
   $str = str_replace("/",'',$str);
   $str = str_replace("(",'',$str);
   $str = str_replace(")",'',$str); 
   $str = str_replace("'",'',$str);
   return $str; 
}


function coronavirus_Facility($Facility_Name,$date,$count){
	// the order we call the function will matter...
	global $core;
	$q = "select * from coronavirus_facility where Facility_Name = '$Facility_Name' and report_date = '$date'";
	$r = $core->query($q);
	$d = mysqli_fetch_array($r);
	// look for yesterday
	$date2 = date('Y-m-d',strtotime($date)-86400);
	$q2 = "select * from coronavirus_facility where Facility_Name = '$Facility_Name' and report_date = '$date2'";
	$r2 = $core->query($q2);
	$d2 = mysqli_fetch_array($r2);
	if ($d2['id'] != ''){
		// Let's Process Trend Data
		$last_trend_direction = $d2['trend_direction'];
		$last_trend_duration = $d2['trend_duration'];
		$last_report_count = $d2['report_count'];
		if ($count == $last_report_count){
			$current_trend = 'FLAT';	
		}elseif ($count > $last_report_count){
			$current_trend = 'UP';	
		}else{
			$current_trend = 'DOWN';
		}
		if ($last_trend_direction == $current_trend){
			$current_duration = $last_trend_duration + 1;
		}else{
			$current_duration = 0;
		}
	}else{
		// we reached the start of data collection.	
	}
	
	if ($d['id'] == ''){
		$q = "insert into coronavirus_facility (Facility_Name,report_date,report_count,town_name,state_name,trend_direction,trend_duration) values ('$Facility_Name','$date','$count','$town','Maryland','$current_trend','$current_duration') ";
	}else{
		$q = "update coronavirus_facility set report_count = '$count', trend_direction = '$current_trend', trend_duration = '$current_duration'  where Facility_Name = '$Facility_Name' and report_date = '$date' ";
		
	}
	$core->query($q);
	slack_general("$q",'covid19-sql');

}





//coronavirus_Facility($Facility_Name,$date,$count);

?>
